const i18n = {
    'zh-CN': {
        langName: '‰∏≠Êñá',
        title: 'ÂÖ®Ëá™Âä®ÂÖªÁâõÂú∫',
        guide: '‰ΩøÁî®ËØ¥Êòé',
        export: 'ÂØºÂá∫ÈÖçÁΩÆ',
        import: 'ÂØºÂÖ•ÈÖçÁΩÆ',
        opensource: 'ÂºÄÊ∫ê',
        switchLang: 'ÂàáÊç¢ËØ≠Ë®Ä',
        addTask: 'Ê∑ªÂä†Êñ∞‰ªªÂä°',
        newTask: 'Êñ∞Âª∫‰ªªÂä°',
        editTask: 'ÁºñËæë‰ªªÂä°',
        running: 'ËøêË°å‰∏≠',
        stopped: 'Â∑≤ÂÅúÊ≠¢',
        stop: 'ÂÅúÊ≠¢',
        start: 'ÂºÄÂßã',
        edit: 'ÁºñËæë',
        cancel: 'ÂèñÊ∂à',
        confirm: 'Á°ÆÂÆö',
        mainAddress: '‰∏ªË¥¶Âè∑Âú∞ÂùÄ',
        mainAddressDesc: 'Â°´ÂÜô‰Ω†ÁöÑ BackPack Èí±ÂåÖÂú∞ÂùÄ',
        privateKey: 'Áî®Êà∑ÁßÅÈí•',
        privateKeyDesc: 'Ê∏∏ÊàèÁßÅÈí•Ôºå‰∏çÊòØ BackPack ÁßÅÈí•',
        minDelay: 'ÊúÄÂ∞èÂª∂Ëøü (ms)',
        maxDelay: 'ÊúÄÂ§ßÂª∂Ëøü (ms)',
        delayDesc: 'Âª∫ËÆÆ {0}ms',
        grassAmount: 'ËçâÁöÑÊï∞Èáè',
        task: '‰ªªÂä°',
        delay: 'Âª∂Ëøü',
        address: 'Âú∞ÂùÄ',
        importConfirm: 'Á°ÆËÆ§ÂØºÂÖ• {0} ‰∏™‰ªªÂä°ÈÖçÁΩÆÔºü',
        importSuccess: '‰ªªÂä°ÂØºÂÖ•ÂÆåÊàêÔºÅ',
        importError: 'ÂØºÂÖ•ÈÖçÁΩÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºèÊòØÂê¶Ê≠£Á°ÆÔºÅ',
        fillAll: 'ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ',
        guideTitle: {
            mainAddress: '‰∏ªË¥¶Âè∑Âú∞ÂùÄ',
            delay: 'Âª∂ËøüËÆæÁΩÆ',
            privateKey: 'Áî®Êà∑ÁßÅÈí•Ëé∑ÂèñÊñπÊ≥ï',
            notice: 'Ê≥®ÊÑè‰∫ãÈ°π'
        },
        guideContent: {
            mainAddressDesc: 'Â°´ÂÜô‰Ω†ÁöÑ BackPack Èí±ÂåÖÂú∞ÂùÄ',
            delayDesc: 'Âª∫ËÆÆÊúÄÂ∞èÂª∂Ëøü 1000msÔºåÊúÄÂ§ßÂª∂Ëøü 2000ms',
            privateKeyWarn: 'Áî®Êà∑ÁßÅÈí•‰∏çÊòØ‰Ω†backpackÁöÑÁßÅÈí•ÔºåÊòØÊ∏∏ÊàèÁßÅÈí•',
            privateKeySteps: [
                'ÊâìÂºÄ Chrome ÂºÄÂèëËÄÖÂ∑•ÂÖ∑ÔºàF12Ôºâ',
                'Âú®ÊéßÂà∂Âè∞ËæìÂÖ•‰ª£Á†ÅÔºö',
                'Â§çÂà∂ËæìÂá∫ÁöÑÁßÅÈí•'
            ],
            noticeDesc: 'ÊâÄÊúâÊìç‰ΩúÂùáÂú®Êú¨Âú∞ÊâßË°åÔºåÂÖ≥Èó≠ÊµèËßàÂô®Âêé‰ªªÂä°Â∞ÜÂÅúÊ≠¢'
        },
        adText: 'Âè∑Â§öÂ§ö | Êé®Áâπ‰ΩéËá≥1ÊØõ5 | hdd.cm',
        codeCopied: '‰ª£Á†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø',
        importPartialSuccess: 'ÊàêÂäüÂØºÂÖ• {0}/{1} ‰∏™‰ªªÂä°\nÂ§±Ë¥•ÂéüÂõ†:',
    },
    'en-US': {
        langName: 'English',
        title: 'Auto Farming Bot',
        guide: 'Guide',
        export: 'Export',
        import: 'Import',
        opensource: 'Open Source',
        switchLang: 'Switch Language',
        addTask: 'Add New Task',
        newTask: 'New Task',
        editTask: 'Edit Task',
        running: 'Running',
        stopped: 'Stopped',
        stop: 'Stop',
        start: 'Start',
        edit: 'Edit',
        cancel: 'Cancel',
        confirm: 'Confirm',
        mainAddress: 'Main Address',
        mainAddressDesc: 'Enter your BackPack wallet address',
        privateKey: 'User Private Key',
        privateKeyDesc: 'Game private key, not BackPack private key',
        minDelay: 'Min Delay (ms)',
        maxDelay: 'Max Delay (ms)',
        delayDesc: 'Recommend {0}ms',
        grassAmount: 'Grass Amount',
        task: 'Task',
        delay: 'Delay',
        address: 'Address',
        importConfirm: 'Confirm import {0} tasks?',
        importSuccess: 'Tasks imported successfully!',
        importError: 'Import failed, please check the file format!',
        fillAll: 'Please fill in all fields',
        guideTitle: {
            mainAddress: 'Main Address',
            delay: 'Delay Settings',
            privateKey: 'How to Get Private Key',
            notice: 'Notice'
        },
        guideContent: {
            mainAddressDesc: 'Enter your BackPack wallet address',
            delayDesc: 'Recommend min delay 1000ms, max delay 2000ms',
            privateKeyWarn: 'User private key is NOT your BackPack private key',
            privateKeySteps: [
                'Open Chrome DevTools (F12)',
                'Enter the code in console:',
                'Copy the output private key'
            ],
            noticeDesc: 'All operations are executed locally, tasks will stop when browser is closed'
        },
        adText: 'HDD.cm | Twitter Account From $0.015',
        codeCopied: 'Code copied to clipboard',
        importPartialSuccess: 'Successfully imported {0}/{1} tasks\nFailure reasons:',
    },
    'ru-RU': {
        langName: '–†—É—Å—Å–∫–∏–π',
        title: '–ê–≤—Ç–æ –§–µ—Ä–º–µ—Ä',
        guide: '–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ',
        export: '–≠–∫—Å–ø–æ—Ä—Ç',
        import: '–ò–º–ø–æ—Ä—Ç',
        opensource: '–û—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–¥',
        switchLang: '–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫',
        addTask: '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É',
        newTask: '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞',
        editTask: '–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É',
        running: '–†–∞–±–æ—Ç–∞–µ—Ç',
        stopped: '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',
        stop: '–°—Ç–æ–ø',
        start: '–°—Ç–∞—Ä—Ç',
        edit: '–ò–∑–º–µ–Ω–∏—Ç—å',
        cancel: '–û—Ç–º–µ–Ω–∞',
        confirm: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
        mainAddress: '–û—Å–Ω–æ–≤–Ω–æ–π –∞–¥—Ä–µ—Å',
        mainAddressDesc: '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ BackPack',
        privateKey: '–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á',
        privateKeyDesc: '–ö–ª—é—á –∏–≥—Ä—ã, –Ω–µ –∫–ª—é—á BackPack',
        minDelay: '–ú–∏–Ω. –∑–∞–¥–µ—Ä–∂–∫–∞ (–º—Å)',
        maxDelay: '–ú–∞–∫—Å. –∑–∞–¥–µ—Ä–∂–∫–∞ (–º—Å)',
        delayDesc: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è {0}–º—Å',
        grassAmount: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–≤—ã',
        task: '–ó–∞–¥–∞—á–∞',
        delay: '–ó–∞–¥–µ—Ä–∂–∫–∞',
        address: '–ê–¥—Ä–µ—Å',
        importConfirm: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–º–ø–æ—Ä—Ç {0} –∑–∞–¥–∞—á?',
        importSuccess: '–ó–∞–¥–∞—á–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!',
        importError: '–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞!',
        fillAll: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è',
        guideTitle: {
            mainAddress: '–û—Å–Ω–æ–≤–Ω–æ–π –∞–¥—Ä–µ—Å',
            delay: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–¥–µ—Ä–∂–∫–∏',
            privateKey: '–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á',
            notice: '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ'
        },
        guideContent: {
            mainAddressDesc: '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞ BackPack',
            delayDesc: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–Ω. –∑–∞–¥–µ—Ä–∂–∫–∞ 1000–º—Å, –º–∞–∫—Å. –∑–∞–¥–µ—Ä–∂–∫–∞ 2000–º—Å',
            privateKeyWarn: '–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –ù–ï —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–æ–º BackPack',
            privateKeySteps: [
                '–û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ Chrome (F12)',
                '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å:',
                '–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–ª—é—á'
            ],
            noticeDesc: '–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –∑–∞–¥–∞—á–∏ –æ—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞'
        },
        adText: 'HDD.cm | –ê–∫–∫–∞—É–Ω—Ç—ã Twitter –æ—Ç $0.015',
        codeCopied: '–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞',
        importPartialSuccess: '–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ {0}/{1} –∑–∞–¥–∞—á\n–ü—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫:',
    }
};

// ÂΩìÂâçËØ≠Ë®Ä
let currentLang = localStorage.getItem('lang') || 'zh-CN';

// Ëé∑ÂèñÁøªËØëÊñáÊú¨
function t(key, ...args) {
    let text = key.split('.').reduce((obj, k) => obj && obj[k], i18n[currentLang]) || key;
    return args.reduce((str, arg, i) => str.replace(`{${i}}`, arg), text);
}

// ÂàáÊç¢ËØ≠Ë®Ä
function switchLang(lang) {
    currentLang = lang;
    localStorage.setItem('lang', lang);
    updatePageText();
    updateLanguageButtons();
    // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂ÔºåÈÄöÁü•ÂÖ∂‰ªñÈúÄË¶ÅÊõ¥Êñ∞ÁöÑÁªÑ‰ª∂
    document.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } }));
}

// Êõ¥Êñ∞È°µÈù¢ÊñáÊú¨
function updatePageText() {
    // Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò
    document.getElementById('pageTitle').textContent = t('title') + 'üêÇ';

    // Êõ¥Êñ∞ÊâÄÊúâÂ∏¶Êúâ data-i18n Â±ûÊÄßÁöÑÂÖÉÁ¥†
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        // Ê£ÄÊü•ÊòØÂê¶ÊúâÂç†‰ΩçÁ¨¶ÂèÇÊï∞
        const args = el.getAttribute('data-i18n-args');
        if (args) {
            el.textContent = t(key, ...args.split(','));
        } else {
            el.textContent = t(key);
        }
        
        // Êõ¥Êñ∞ placeholder Â±ûÊÄßÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
        if (el.hasAttribute('placeholder')) {
            el.placeholder = t(key);
        }
        
        // Êõ¥Êñ∞ title Â±ûÊÄßÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
        if (el.hasAttribute('title')) {
            el.title = t(key);
        }
    });

    // Êõ¥Êñ∞Âä®ÊÄÅÂàõÂª∫ÁöÑÂÜÖÂÆπ
    updateDynamicContent();
}

// Êõ¥Êñ∞Âä®ÊÄÅÂàõÂª∫ÁöÑÂÜÖÂÆπ
function updateDynamicContent() {
    // Êõ¥Êñ∞‰ªªÂä°Âç°Áâá
    document.querySelectorAll('[id^="task-"]').forEach(card => {
        const statusSpan = card.querySelector('.status-running, .status-stopped');
        const toggleBtn = card.querySelector('.toggle-btn');
        const addressText = card.querySelector('.address-text');
        const delayText = card.querySelector('.delay-text');
        const grassText = card.querySelector('.grass-text');
        const editText = card.querySelector('.edit-text');
        const taskText = card.querySelector('.task-text');
        
        if (statusSpan) {
            const isRunning = statusSpan.classList.contains('status-running');
            statusSpan.innerHTML = `
                <span class="material-icons text-sm mr-1">
                    ${isRunning ? 'radio_button_checked' : 'radio_button_unchecked'}
                </span>
                ${t(isRunning ? 'running' : 'stopped')}
            `;
        }
        
        if (toggleBtn) {
            const isRunning = toggleBtn.innerHTML.includes('stop');
            toggleBtn.innerHTML = `
                <span class="material-icons text-sm mr-2">
                    ${isRunning ? 'stop' : 'play_arrow'}
                </span>
                ${t(isRunning ? 'stop' : 'start')}
            `;
        }
        
        if (addressText) {
            const address = card.getAttribute('data-address');
            addressText.textContent = `${t('address')}: ${address.slice(0, 6)}...${address.slice(-4)}`;
        }
        
        if (delayText) {
            const delays = card.getAttribute('data-delays').split('-');
            delayText.textContent = `${t('delay')}: ${delays[0]}-${delays[1]}ms`;
        }
        
        if (grassText) {
            grassText.textContent = `${t('grassAmount')}:`;
        }
        
        if (taskText) {
            taskText.textContent = t('task');
        }
        
        if (editText) {
            editText.textContent = t('edit');
        }
    });
}

// ÂàùÂßãÂåñËØ≠Ë®ÄËÆæÁΩÆ
document.addEventListener('DOMContentLoaded', () => {
    // Êõ¥Êñ∞ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆÁä∂ÊÄÅ
    updateLanguageButtons();
    // ÂàùÂßãÂåñÈ°µÈù¢ÊñáÊú¨
    updatePageText();
});

// Êõ¥Êñ∞ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆÁä∂ÊÄÅ
function updateLanguageButtons() {
    document.querySelectorAll('.language-switcher').forEach(btn => {
        const lang = btn.getAttribute('data-lang');
        if (lang === currentLang) {
            btn.classList.add('bg-blue-500', 'text-white');
            btn.classList.remove('text-gray-600', 'hover:bg-gray-100');
        } else {
            btn.classList.remove('bg-blue-500', 'text-white');
            btn.classList.add('text-gray-600', 'hover:bg-gray-100');
        }
    });
}

// ÂØºÂá∫ÈúÄË¶ÅÁöÑÂáΩÊï∞ÂíåÂèòÈáè
window.t = t;
window.switchLang = switchLang;
window.updatePageText = updatePageText;
window.currentLang = currentLang; 